<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ŸÖÿ¥ÿ∫ŸÑ ŸÅŸäÿØŸäŸà + ŸÖŸÑÿÆÿµ ÿ∞ŸÉŸä</title>
  <style>
    body {
      text-align: right; /* [2] */
      font-family: 'Arial', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* [2] */
      background-color: #f9f9f9; /* [2] */
      margin: 0; /* [2] */
      padding: 20px; /* [2] */
      transition: background-color 0.3s, color 0.3s; /* [2] */
    } /* [3] */
    #videoContainer, #summaryBox, #transcriptInput, .search-box, .notes-section { /* [3] */
      width: 90%; /* [3] */
      max-width: 900px; /* [3] */
      margin: 15px auto; /* [4] */
      text-align: right; /* [4] */
      font-size: 16px; /* [4] */
      line-height: 1.8; /* [4] */
      background-color: #fff; /* [4] */
      padding: 20px; /* [4] */
      border-radius: 8px; /* [4] */
      box-shadow: 0px 2px 5px rgba(0,0,0,0.2); /* [4] */
    } /* [5] */
    textarea { /* [5] */
      width: 100%; /* [5] */
      height: 150px; /* [5] */
      font-size: 16px; /* [5] */
      padding: 12px; /* [5] */
      margin-top: 10px; /* [6] */
      border: 1px solid #ddd; /* [6] */
      border-radius: 5px; /* [6] */
      transition: background-color 0.3s, color 0.3s; /* [6] */
      font-family: 'Arial', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* [7] */
      text-align: right; /* [7] */
      direction: rtl; /* [7] */
    } /* [8] */
    input[type="text"] { /* [8] */
      width: 70%; /* [8] */
      padding: 12px; /* [8] */
      margin: 8px; /* [8] */
      border: 1px solid #ddd; /* [9] */
      border-radius: 5px; /* [9] */
      font-size: 16px; /* [9] */
      font-family: 'Arial', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* [9] */
      text-align: right; /* [9] */
      direction: rtl; /* [9] */
    } /* [10] */
    .control-btn { /* [10] */
      padding: 12px 20px; /* [10] */
      margin: 10px; /* [10] */
      font-size: 16px; /* [10] */
      cursor: pointer; /* [10] */
      border: none; /* [11] */
      border-radius: 5px; /* [11] */
      background-color: #007bff; /* [11] */
      color: white; /* [11] */
      transition: 0.3s; /* [11] */
      box-shadow: 0px 2px 5px rgba(0,0,0,0.2); /* [11] */
      font-family: 'Arial', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* [12] */
    }
    .control-btn:hover { /* [12] */
      background-color: #0056b3; /* [12] */
    } /* [13] */
    iframe { /* [13] */
      width: 100%; /* [13] */
      height: 450px; /* [13] */
      border-radius: 8px; /* [13] */
      border: none; /* [13] */
    } /* [14] */
    .floating-controls { /* [14] */
      position: fixed; /* [14] */
      bottom: 25px; /* [14] */
      left: 25px; /* [14] */
      display: flex; /* [14] */
      flex-direction: column; /* [15] */
      gap: 12px; /* [15] */
      z-index: 1000; /* [15] */
    }
    .floating-right-controls { /* [15] */
      position: fixed; /* [15] */
      bottom: 25px; /* [16] */
      right: 25px; /* [16] */
      display: flex; /* [16] */
      flex-direction: column; /* [16] */
      gap: 12px; /* [16] */
      z-index: 1000; /* [16] */
    } /* [17] */
    #notesList { /* [17] */
      list-style-type: none; /* [17] */
      padding: 0; /* [17] */
      width: 90%; /* [17] */
      max-width: 900px; /* [17] */
      margin: 20px auto; /* [18] */
    }
    #notesList li { /* [18] */
      background-color: #fff; /* [18] */
      padding: 15px; /* [18] */
      margin-bottom: 10px; /* [19] */
      border-radius: 5px; /* [19] */
      box-shadow: 0px 1px 3px rgba(0,0,0,0.1); /* [19] */
      text-align: right; /* [19] */
      font-size: 15px; /* [19] */
      line-height: 1.6; /* [19] */
    } /* [20] */
    .speed-controls { /* [20] */
      display: flex; /* [20] */
      flex-wrap: wrap; /* [20] */
      justify-content: center; /* [20] */
      gap: 10px; /* [20] */
      margin-top: 20px; /* [21] */
    }
    .speed-btn { /* [21] */
      min-width: 65px; /* [21] */
      padding: 12px; /* [21] */
    } /* [22] */
    .clear-search-btn { /* [22] */
      padding: 12px 18px; /* [22] */
      margin: 10px; /* [22] */
      font-size: 15px; /* [22] */
      cursor: pointer; /* [22] */
      border: none; /* [23] */
      border-radius: 5px; /* [23] */
      background-color: #dc3545; /* [23] */
      color: white; /* [23] */
      transition: 0.3s; /* [23] */
      box-shadow: 0px 2px 5px rgba(0,0,0,0.2); /* [23] */
      font-family: 'Arial', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* [24] */
    }
    .clear-search-btn:hover { /* [24] */
      background-color: #c82333; /* [24] */
    } /* [25] */

    /* Dark Mode Styles */
    .dark-mode { /* [25] */
      background-color: #121212; /* [25] */
      color: #e0e0e0; /* [26] */
    }
    .dark-mode #videoContainer, /* [26] */
    .dark-mode #summaryBox, /* [26] */
    .dark-mode #transcriptInput, /* [26] */
    .dark-mode .search-box, /* [26] */
    .dark-mode .notes-section { /* [26] */
      background-color: #1e1e1e; /* [26] */
      color: #e0e0e0; /* [27] */
      border: 1px solid #333; /* [27] */
    }
    .dark-mode textarea { /* [27] */
      background-color: #2d2d2d; /* [27] */
      color: #e0e0e0; /* [28] */
      border: 1px solid #444; /* [28] */
    }
    .dark-mode input[type="text"] { /* [28] */
      background-color: #2d2d2d; /* [28] */
      color: #e0e0e0; /* [29] */
      border: 1px solid #444; /* [29] */
    }
    .dark-mode .control-btn { /* [29] */
      background-color: #444; /* [29] */
      color: #fff; /* [30] */
    }
    .dark-mode .control-btn:hover { /* [30] */
      background-color: #555; /* [30] */
    } /* [31] */
    .dark-mode #notesList li { /* [31] */
      background-color: #2d2d2d; /* [31] */
      color: #e0e0e0; /* [31] */
      border: 1px solid #444; /* [32] */
    }
    .dark-mode .clear-search-btn { /* [32] */
      background-color: #a71d2a; /* [32] */
    } /* [33] */
    .dark-mode .clear-search-btn:hover { /* [33] */
      background-color: #8c1a24; /* [33] */
    } /* [34] */

    /* Highlight Styles */
    .highlight { /* [34] */
      background-color: yellow; /* [34] */
      color: black; /* [35] */
      padding: 0 3px; /* [35] */
      border-radius: 3px; /* [35] */
    }
    .highlight-line { /* [35] */
      background-color: rgba(255, 255, 0, 0.3); /* [35] */
      border-left: 4px solid yellow; /* [36] */
      padding: 10px; /* [36] */
      margin: 10px 0; /* [36] */
      cursor: pointer; /* [36] */
      border-radius: 0 6px 6px 0; /* [36] */
    } /* [37] */
    .highlight-line:hover { /* [37] */
      background-color: rgba(255, 255, 0, 0.5); /* [37] */
    } /* [38] */

    /* Summary Box Styles */
    #summaryBox { /* [38] */
      text-align: right; /* [38] */
      white-space: normal; /* [39] */
      font-family: 'Arial', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* [39] */
      line-height: 1.8; /* [39] */
      padding: 20px; /* [39] */
      overflow-wrap: break-word; /* [39] */
    } /* [40] */
    #summaryBox b { /* [40] */
      font-weight: bold; /* [40] */
      color: #007bff; /* [40] */
    } /* [41] */
    #summaryBox i { /* [41] */
      font-style: italic; /* [41] */
    } /* [42] */
    #summaryBox u { /* [42] */
      text-decoration: underline; /* [42] */
    } /* [43] */
    .note-link { /* [43] */
      color: #007bff; /* [43] */
      cursor: pointer; /* [43] */
      text-decoration: underline; /* [43] */
    } /* [44] */

    /* LaTeX Styles */
    .latex { /* [44] */
      color: #d63384; /* [44] */
      font-family: "Courier New", monospace; /* [45] */
      background-color: rgba(214, 51, 132, 0.1); /* [45] */
      padding: 2px 8px; /* [45] */
      border-radius: 4px; /* [45] */
      font-size: 1.1em; /* [45] */
    } /* [46] */
    .math-container { /* [46] */
      margin: 20px 0; /* [46] */
      padding: 15px; /* [46] */
      background-color: rgba(248, 249, 250, 0.7); /* [47] */
      border-radius: 6px; /* [47] */
      border-left: 5px solid #d63384; /* [47] */
      overflow-x: auto; /* [47] */
      text-align: center; /* [47] */
    } /* [48] */
    .dark-mode .latex { /* [48] */
      color: #ff6b9e; /* [48] */
      background-color: rgba(255, 107, 158, 0.1); /* [48] */
    } /* [49] */
    .dark-mode .math-container { /* [49] */
      background-color: rgba(30, 30, 30, 0.7); /* [49] */
      border-left-color: #ff6b9e; /* [49] */
    } /* [50] */

    /* Summary Sections */
    .summary-section { /* [50] */
      background-color: rgba(0, 123, 255, 0.05); /* [50] */
      border-left: 5px solid #007bff; /* [51] */
      padding: 15px; /* [51] */
      margin: 20px 0; /* [51] */
      border-radius: 0 6px 6px 0; /* [51] */
    } /* [52] */
    .summary-title { /* [52] */
      color: #007bff; /* [52] */
      font-weight: bold; /* [52] */
      margin-bottom: 10px; /* [52] */
      font-size: 18px; /* [52] */
    } /* [53] */
    .summary-laws { /* [53] */
      background-color: rgba(23, 162, 184, 0.05); /* [53] */
      border-left: 5px solid #17a2b8; /* [53] */
      padding: 12px; /* [54] */
      margin: 15px 0; /* [54] */
      border-radius: 0 6px 6px 0; /* [54] */
    } /* [55] */
    .law-title { /* [55] */
      color: #17a2b8; /* [55] */
      font-weight: bold; /* [55] */
      margin-bottom: 8px; /* [55] */
      font-size: 16px; /* [55] */
    } /* [56] */
    .dark-mode .summary-section { /* [56] */
      background-color: rgba(0, 123, 255, 0.1); /* [56] */
    } /* [57] */
    .dark-mode .summary-laws { /* [57] */
      background-color: rgba(23, 162, 184, 0.1); /* [57] */
    } /* [58] */
  </style>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>

  <h2 style="margin-bottom: 25px; color: #007bff;">üì∫ ŸÖÿ¥ÿ∫ŸÑ ŸÅŸäÿØŸäŸà ŸÖÿ™ŸÉÿßŸÖŸÑ + ÿ™ŸÑÿÆŸäÿµ ÿ∞ŸÉŸä</h2>

  <div style="margin-bottom: 25px;">
    <input type="text" id="videoUrl" placeholder="ÿ£ÿØÿÆŸÑ ÿ±ÿßÿ®ÿ∑ ŸÅŸäÿØŸäŸà ŸäŸàÿ™ŸäŸàÿ®" style="width: 65%; padding: 12px;">
    <button class="control-btn" onclick="loadVideo()">üé¨ ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑŸÅŸäÿØŸäŸà</button>
  </div>

  <div id="videoContainer"></div>

  <div class="speed-controls">
    <button class="control-btn speed-btn" onclick="changeSpeed(0.5)">0.5x</button>
    <button class="control-btn speed-btn" onclick="changeSpeed(0.75)">0.75x</button>
    <button class="control-btn speed-btn" onclick="changeSpeed(1)">1x</button>
    <button class="control-btn speed-btn" onclick="changeSpeed(1.25)">1.25x</button>
    <button class="control-btn speed-btn" onclick="changeSpeed(1.5)">1.5x</button>
    <button class="control-btn speed-btn" onclick="changeSpeed(2)">2x</button>
  </div> /* [59] */

  <div class="floating-controls">
    <button class="control-btn" onclick="seek(-10)">‚è™ ÿ±ÿ¨Ÿàÿπ 10 ÿ´ŸàÿßŸÜŸç</button>
    <button class="control-btn" onclick="seek(10)">‚è© ÿ™ŸÇÿØŸäŸÖ 10 ÿ´ŸàÿßŸÜŸç</button>
  </div>

  <div class="floating-right-controls">
    <button class="control-btn" id="playPauseBtn" onclick="togglePlayPause()">‚è∏ ÿ•ŸäŸÇÿßŸÅ</button>
  </div>

  <div class="notes-section">
    <h3 style="margin-top: 0; color: #17a2b8;">üìù ÿßŸÑŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™</h3> /* [60] */
    <textarea id="noteText" placeholder="ÿßŸÉÿ™ÿ® ŸÖŸÑÿßÿ≠ÿ∏ÿ© ŸáŸÜÿß..."></textarea>
    <button class="control-btn" onclick="saveNote()">üíæ ÿ≠ŸÅÿ∏ ÿßŸÑŸÖŸÑÿßÿ≠ÿ∏ÿ©</button>
  </div>

  <ul id="notesList"></ul> /* [18] */

  <div class="search-box">
    <h3 style="margin-top: 0; color: #d63384;">üîç ÿ®ÿ≠ÿ´ ŸÅŸä ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÅŸäÿØŸäŸà</h3> /* [61] */
    <input type="text" id="searchText" placeholder="ÿßÿ®ÿ≠ÿ´ ŸÅŸä ŸÜÿµ ÿßŸÑŸÅŸäÿØŸäŸà...">
    <button class="control-btn" onclick="searchInText()">ÿ®ÿ≠ÿ´</button>
    <button class="clear-search-btn" onclick="clearSearch()" id="clearSearchBtn" style="display:none;">‚úñ ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ®ÿ≠ÿ´</button>
    <div id="searchResults" style="margin-top: 15px; text-align: right;"></div> /* [62] */
  </div>

  <div style="margin-top: 25px;">
    <h3 style="margin-bottom: 15px; color: #6f42c1;">üìå ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ© ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿäÿ© ÿ£Ÿà ÿ£ÿØÿÆŸÑ ÿßŸÑŸÜÿµ ŸäÿØŸàŸäŸãÿß:</h3> /* [63] */
    <textarea id="transcriptInput" placeholder="ÿßŸÜÿ™ÿ∏ÿ± ÿ¨ŸÑÿ® ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ© ÿ£Ÿà ÿßŸÑÿµŸÇŸáÿß ŸáŸÜÿß..." style="height: 180px;"></textarea>
    <button class="control-btn" onclick="summarizeText()" style="margin-top: 15px;">üìù ÿ™ŸàŸÑŸäÿØ ŸÖŸÑÿÆÿµ</button>
  </div>

  <div id="summaryBox" style="margin-top: 25px; min-height: 150px;">üîç ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ŸàŸÑŸäÿØ ŸÖŸÑÿÆÿµ ÿ®ÿπÿØ.</div> /* [64] */

  <button class="control-btn" onclick="toggleDarkMode()" style="margin: 25px auto; padding: 12px 25px;">üåô ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÑŸäŸÑŸä</button> /* [65] */

  <script>
    const OPENROUTER_API_KEY = "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"; // ÿßÿ≥ÿ™ÿ®ÿØŸÑ ÿ®ŸÖŸÅÿ™ÿßÿ≠ŸÉ ÿßŸÑÿÆÿßÿµ ÿ•ÿ∞ÿß ŸÑÿ≤ŸÖ ÿßŸÑÿ£ŸÖÿ±
    let player;
    let notes = [];
    let captionsData = [];
    let isPlaying = false; // ÿßÿ®ÿØÿ£ ÿ®ÿ≠ÿßŸÑÿ© ÿßŸÑÿ•ŸäŸÇÿßŸÅ ÿßŸÅÿ™ÿ±ÿßÿ∂ŸäŸãÿß
    let currentHighlights = {}; // ÿ™ŸáŸäÿ¶ÿ© ŸÉŸÉÿßÿ¶ŸÜ ŸÅÿßÿ±ÿ∫
    let playerReady = false;

    // 1. ÿ™ÿ≠ŸÖŸäŸÑ Ÿàÿßÿ¨Ÿáÿ© ÿ®ÿ±ŸÖÿ¨ÿ© ŸäŸàÿ™ŸäŸàÿ®
    function loadYouTubeAPI() {
      const tag = document.createElement('script');
      // !!! ÿ™ÿµÿ≠Ÿäÿ≠ ÿßŸÑÿ±ÿßÿ®ÿ∑ !!!
      tag.src = "https://www.youtube.com/iframe_api";
      const firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    }

    // 2. Ÿáÿ∞Ÿá ÿßŸÑÿØÿßŸÑÿ© ÿ≥ÿ™Ÿèÿ≥ÿ™ÿØÿπŸâ ÿ™ŸÑŸÇÿßÿ¶ŸäŸãÿß ÿ®Ÿàÿßÿ≥ÿ∑ÿ© ÿßŸÑŸàÿßÿ¨Ÿáÿ© ÿßŸÑÿ®ÿ±ŸÖÿ¨Ÿäÿ© ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑŸáÿß
    function onYouTubeIframeAPIReady() { /* [66] */
      console.log("YouTube API ÿ¨ÿßŸáÿ≤ÿ© ŸÑŸÑÿπŸÖŸÑ");
      // ŸÑÿß ŸÜŸÇŸÖ ÿ®ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖÿ¥ÿ∫ŸÑ ŸáŸÜÿß ŸÖÿ®ÿßÿ¥ÿ±ÿ©ÿå ÿ®ŸÑ ÿπŸÜÿØ ÿßŸÑÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿßŸÑÿ≤ÿ±
    }

    // 3. ÿØÿßŸÑÿ© ŸÑŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ¨ÿßŸáÿ≤Ÿäÿ© ÿßŸÑŸÖÿ¥ÿ∫ŸÑ
    function isPlayerReady() {
      // ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜ ÿßŸÑŸÖÿ¥ÿ∫ŸÑ ŸÑŸäÿ≥ ŸÅŸÇÿ∑ ŸÖÿπÿ±ŸÅŸãÿßÿå ÿ®ŸÑ ŸÑÿØŸäŸá ÿßŸÑÿØŸàÿßŸÑ ÿßŸÑŸÑÿßÿ≤ŸÖÿ© Ÿàÿ£ŸÜ playerReady true
      return playerReady && player && typeof player.getPlayerState === 'function'; /* [65] */
    }

    // 4. ÿØÿßŸÑÿ© ŸÖŸÜŸÅÿµŸÑÿ© ŸÑŸÖÿπÿßŸÑÿ¨ÿ© ÿ≠ÿØÿ´ onReady ÿßŸÑÿÆÿßÿµ ÿ®ÿßŸÑŸÖÿ¥ÿ∫ŸÑ
    function onPlayerReady(event) {
      console.log("ÿßŸÑŸÖÿ¥ÿ∫ŸÑ ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ (onReady event fired)");
      player = event.target; /* [69] */ // ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿ±ÿ¨ÿπ ÿßŸÑŸÖÿ¥ÿ∫ŸÑ
      playerReady = true; /* [71] */
      // ŸÑÿß ÿ™ŸÇŸÖ ÿ®ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑŸÅŸäÿØŸäŸà ÿ™ŸÑŸÇÿßÿ¶ŸäŸãÿß ŸáŸÜÿß ÿ•ŸÑÿß ÿ•ÿ∞ÿß ŸÉŸÜÿ™ ÿ™ÿ±ŸäÿØ ÿ∞ŸÑŸÉ
      // player.playVideo();
      // isPlaying = true; // ÿ≥Ÿäÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´Ÿá ÿ®Ÿàÿßÿ≥ÿ∑ÿ© onStateChange
      updatePlayPauseButton(); // ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ≤ÿ±
    }

    // 5. ÿØÿßŸÑÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÅŸäÿØŸäŸà ÿπŸÜÿØ ÿßŸÑÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿßŸÑÿ≤ÿ±
    function loadVideo() {
      const url = document.getElementById("videoUrl").value;
      const videoId = extractVideoID(url);
      if (!videoId) {
        alert("‚ùå Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿ±ÿßÿ®ÿ∑ ŸäŸàÿ™ŸäŸàÿ® ÿµÿ≠Ÿäÿ≠");
        return;
      }

      // ÿ∂ÿπ ÿπŸÑÿßŸÖÿ© ÿπŸÑŸâ ÿ£ŸÜ ÿßŸÑŸÖÿ¥ÿ∫ŸÑ ŸÑŸäÿ≥ ÿ¨ÿßŸáÿ≤Ÿãÿß ÿ®ÿπÿØ (ÿ£Ÿà ŸÇŸäÿØ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ)
      playerReady = false; /* [67] */
      isPlaying = false; // ÿßŸÅÿ™ÿ±ÿ∂ ÿ£ŸÜŸá ŸÖÿ™ŸàŸÇŸÅ ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ŸÅŸäÿØŸäŸà ÿ¨ÿØŸäÿØ
      updatePlayPauseButton(); // ŸÇŸÖ ÿ®ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≤ÿ± ŸÑŸäÿπŸÉÿ≥ ÿ≠ÿßŸÑÿ© ÿπÿØŸÖ ÿßŸÑÿ¨ÿßŸáÿ≤Ÿäÿ©

      if (player && typeof player.loadVideoById === 'function') {
        // ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑŸÖÿ¥ÿ∫ŸÑ ŸÖŸàÿ¨ŸàÿØŸãÿß ÿ®ÿßŸÑŸÅÿπŸÑÿå ŸÅŸÇÿ∑ ŸÇŸÖ ÿ®ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÅŸäÿØŸäŸà ÿßŸÑÿ¨ÿØŸäÿØ
        console.log("ÿßŸÑŸÖÿ¥ÿ∫ŸÑ ŸÖŸàÿ¨ŸàÿØÿå ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ŸÅŸäÿØŸäŸà ÿ¨ÿØŸäÿØ:", videoId);
        // ŸÑÿß ŸÜŸÇŸÖ ÿ®ŸÄ player.destroy() ÿ•ŸÑÿß ÿ•ÿ∞ÿß Ÿàÿßÿ¨Ÿáÿ™ ŸÖÿ¥ÿßŸÉŸÑÿå loadVideoById ÿπÿßÿØÿ© ŸÉÿßŸÅŸäÿ©
        player.loadVideoById(videoId);
        // onReady ÿ≥ÿ™Ÿèÿ≥ÿ™ÿØÿπŸâ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÅŸäÿØŸäŸà ÿßŸÑÿ¨ÿØŸäÿØ ÿ•ÿ∞ÿß ŸÑÿ≤ŸÖ ÿßŸÑÿ£ŸÖÿ±
      } else {
        // ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ ÿßŸÑŸÖÿ¥ÿ∫ŸÑ ŸÖŸàÿ¨ŸàÿØŸãÿßÿå ÿ£Ÿà ŸÉÿßŸÜÿ™ ŸáŸÜÿßŸÉ ŸÖÿ¥ŸÉŸÑÿ©ÿå ÿ£ŸÜÿ¥ÿ¶ Ÿàÿßÿ≠ÿØŸãÿß ÿ¨ÿØŸäÿØŸãÿß
        console.log("ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ¥ÿ∫ŸÑ ŸäŸàÿ™ŸäŸàÿ® ÿ¨ÿØŸäÿØ ŸÑŸÑŸÅŸäÿØŸäŸà:", videoId);
        // ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜ ÿßŸÑÿ≠ÿßŸàŸäÿ© ŸÅÿßÿ±ÿ∫ÿ© ŸÇÿ®ŸÑ ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ¥ÿ∫ŸÑ ÿ¨ÿØŸäÿØ
        document.getElementById("videoContainer").innerHTML = '<div id="youtubePlayer"></div>'; /* [67] */
        player = new YT.Player('youtubePlayer', { /* [70] */
          height: '450', /* [70] */
          width: '100%', /* [70] */
          videoId: videoId, /* [70] */
          playerVars: {
              'playsinline': 1 // ŸÖŸáŸÖ ŸÑÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑŸÅŸäÿØŸäŸà ŸÖÿ∂ŸÖŸÜŸãÿß ÿπŸÑŸâ ÿßŸÑÿ¨ŸàÿßŸÑ
          },
          events: { /* [70] */
              'onReady': onPlayerReady, // ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿØÿßŸÑÿ© ÿßŸÑŸÖŸÜŸÅÿµŸÑÿ© ŸÑŸÑÿ¨ÿßŸáÿ≤Ÿäÿ© /* [71] */
              'onStateChange': onPlayerStateChange /* [71] */
          }
        });
      } /* [72] */

      fetchTranscript(videoId);
    } /* [73] */

    function extractVideoID(url) {
      // ÿ™ÿ≠ÿ≥ŸäŸÜ ÿ∑ŸÅŸäŸÅ ŸÑŸÑÿ™ÿπÿßŸÖŸÑ ŸÖÿπ ÿ±Ÿàÿßÿ®ÿ∑ shorts Ÿàÿ±Ÿàÿßÿ®ÿ∑ ÿ£ÿÆÿ±Ÿâ ŸÖÿ≠ÿ™ŸÖŸÑÿ©
      const patterns = [
          /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/|youtube\.com\/shorts\/)([^"&?\/\s]{11})/i
      ];
      for (const pattern of patterns) {
        const match = url.match(pattern);
        if (match && match[1]) {
          return match[1]; /* [74] */
        }
      }
      return null;
    }

    function onPlayerStateChange(event) {
      if (event.data == YT.PlayerState.PLAYING) { /* [74] */
        isPlaying = true; /* [74] */
      } else if (event.data == YT.PlayerState.PAUSED || event.data == YT.PlayerState.ENDED) { /* [75] */
        isPlaying = false; /* [75] */
      } /* [76] */
      updatePlayPauseButton(); /* [76] */
    }

    function togglePlayPause() {
      if (!isPlayerReady()) {
        alert("‚ùå Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ± ÿ≠ÿ™Ÿâ Ÿäÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÅŸäÿØŸäŸà ÿ®ÿßŸÑŸÉÿßŸÖŸÑ Ÿàÿ¨ÿßŸáÿ≤Ÿäÿ™Ÿá"); /* [76] */
        return; /* [77] */
      }
      try {
        if (player.getPlayerState() === YT.PlayerState.PLAYING) { /* [77] */
          player.pauseVideo(); /* [77] */
          // isPlaying ÿ≥Ÿäÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´Ÿáÿß ÿ®Ÿàÿßÿ≥ÿ∑ÿ© onPlayerStateChange
        } else { /* [78] */
          player.playVideo(); /* [78] */
          // isPlaying ÿ≥Ÿäÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´Ÿáÿß ÿ®Ÿàÿßÿ≥ÿ∑ÿ© onPlayerStateChange
        } /* [79] */
        // updatePlayPauseButton(); // ÿ™ŸÖ ŸÜŸÇŸÑŸáÿß ÿ•ŸÑŸâ onPlayerStateChange
      } catch (e) { /* [79] */
        console.error("ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿ®ÿßŸÑŸÖÿ¥ÿ∫ŸÑ:", e); /* [79] */
        alert("‚ùå ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿ®ÿßŸÑŸÖÿ¥ÿ∫ŸÑ"); /* [80] */
      }
    }

    function updatePlayPauseButton() {
      const btn = document.getElementById("playPauseBtn"); /* [80] */
      if (!playerReady) {
          btn.innerHTML = "‚è≥ ÿ™ÿ≠ŸÖŸäŸÑ..."; // ÿ£Ÿà ÿ£Ÿä ŸÜÿµ Ÿäÿ¥Ÿäÿ± ŸÑÿπÿØŸÖ ÿßŸÑÿ¨ÿßŸáÿ≤Ÿäÿ©
          btn.disabled = true; // ÿ™ÿπÿ∑ŸäŸÑ ÿßŸÑÿ≤ÿ± ŸÖÿ§ŸÇÿ™Ÿãÿß
      } else if (isPlaying) { /* [81] */
        btn.innerHTML = "‚è∏ ÿ•ŸäŸÇÿßŸÅ"; /* [81] */
        btn.disabled = false;
      } else { /* [82] */
        btn.innerHTML = "‚ñ∂ ÿ™ÿ¥ÿ∫ŸäŸÑ"; /* [82] */
        btn.disabled = false;
      } /* [83] */
    }

    function changeSpeed(speed) {
      if (!isPlayerReady()) {
        alert("‚ùå Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ± ÿ≠ÿ™Ÿâ Ÿäÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÅŸäÿØŸäŸà ÿ®ÿßŸÑŸÉÿßŸÖŸÑ Ÿàÿ¨ÿßŸáÿ≤Ÿäÿ™Ÿá"); /* [83] */
        return; /* [84] */
      }
      try {
        player.setPlaybackRate(speed); /* [84] */
        console.log("ÿ™ŸÖ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ≥ÿ±ÿπÿ© ÿ•ŸÑŸâ:", speed); /* [85] */
      } catch (e) { /* [85] */
        console.error("ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ≥ÿ±ÿπÿ©:", e); /* [85] */
        alert("‚ùå ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ≥ÿ±ÿπÿ©"); /* [86] */
      }
    }

    function seek(seconds) {
      if (!isPlayerReady()) {
        alert("‚ùå Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ± ÿ≠ÿ™Ÿâ Ÿäÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÅŸäÿØŸäŸà ÿ®ÿßŸÑŸÉÿßŸÖŸÑ Ÿàÿ¨ÿßŸáÿ≤Ÿäÿ™Ÿá"); /* [86] */
        return; /* [87] */
      }
      try {
        let currentTime = player.getCurrentTime(); /* [87] */
        let newTime = currentTime + seconds; /* [88] */
        if (newTime < 0) newTime = 0; /* [88] */
        // ÿ™ÿ≠ŸÇŸÇ ÿ£Ÿäÿ∂Ÿãÿß ŸÖŸÜ ÿ£ŸÑÿß ÿ™ÿ™ÿ¨ÿßŸàÿ≤ ŸÖÿØÿ© ÿßŸÑŸÅŸäÿØŸäŸà (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä ŸÑŸÉŸÜ ÿ¨ŸäÿØ)
        // const duration = player.getDuration();
        // if (newTime > duration) newTime = duration;
        player.seekTo(newTime, true); /* [88] */
        console.log("ÿ™ŸÖ ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ÿ•ŸÑŸâ:", newTime); /* [88] */
      } catch (e) { /* [89] */
        console.error("ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ:", e); /* [89] */
        alert("‚ùå ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ"); /* [90] */
      }
    }

    // --- ÿ®ÿßŸÇŸä ÿßŸÑÿØŸàÿßŸÑ (fetchTranscript, searchInText, summarizeText, ÿ•ŸÑÿÆ) ÿ™ÿ®ŸÇŸâ ŸÉŸÖÿß ŸáŸä ---

    async function fetchTranscript(videoId) {
      document.getElementById("transcriptInput").value = "‚è≥ ÿ¨ÿßÿ±Ÿä ÿ¨ŸÑÿ® ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ©..."; /* [90] */
      try { /* [91] */
        // ŸÖÿ´ÿßŸÑ ŸÑŸÜÿµ ÿßŸÑŸÅŸäÿØŸäŸà (ŸäŸÖŸÉŸÜ ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑŸá ÿ®API ÿ≠ŸÇŸäŸÇŸä)
        // ŸÖŸÑÿßÿ≠ÿ∏ÿ©: ÿ¨ŸÑÿ® ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ© ÿ™ŸÑŸÇÿßÿ¶ŸäŸãÿß ŸÖŸÜ ŸäŸàÿ™ŸäŸàÿ® Ÿäÿ™ÿ∑ŸÑÿ® API ÿ£ŸÉÿ´ÿ± ÿ™ÿπŸÇŸäÿØŸãÿß ÿ£Ÿà ÿÆÿØŸÖÿ© ÿÆÿßÿ±ÿ¨Ÿäÿ©
        // ÿ≥ŸÜÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿ∂ŸÖŸÜ ŸÉŸÖÿ´ÿßŸÑ ÿßŸÑÿ¢ŸÜ
        const mockTranscript = `1. ŸÖŸÇÿØŸÖÿ© ÿπŸÜ ÿßŸÑŸÅŸäÿ≤Ÿäÿßÿ° /* [91] */
ŸÅŸä Ÿáÿ∞ÿß ÿßŸÑÿØÿ±ÿ≥ ÿ≥ŸÜÿ™ÿπÿ±ŸÅ ÿπŸÑŸâ ÿ£ÿ≥ÿßÿ≥Ÿäÿßÿ™ ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ° ŸàÿßŸÑÿ™Ÿäÿßÿ± ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ¶Ÿä. /* [92] */
2. ÿßŸÑÿ™Ÿäÿßÿ± ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ¶Ÿä /* [93] */
ÿßŸÑÿ™Ÿäÿßÿ± ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ¶Ÿä (I) ŸáŸà ŸÖÿπÿØŸÑ ÿ™ÿØŸÅŸÇ ÿßŸÑÿ¥ÿ≠ŸÜÿ© ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ¶Ÿäÿ© (Q) ÿÆŸÑÿßŸÑ ÿßŸÑÿ≤ŸÖŸÜ (t) ÿ≠ÿ≥ÿ® ÿßŸÑŸÇÿßŸÜŸàŸÜ: /* [93] */
\\( I = \\frac{Q}{t} \\) /* [93] */

Ÿàÿ≠ÿØÿ© ŸÇŸäÿßÿ≥ ÿßŸÑÿ™Ÿäÿßÿ± ŸáŸä ÿßŸÑÿ£ŸÖÿ®Ÿäÿ± (A). /* [93] */
3. ŸÇÿßŸÜŸàŸÜ ÿ£ŸàŸÖ /* [94] */
ŸäŸÜÿµ ŸÇÿßŸÜŸàŸÜ ÿ£ŸàŸÖ ÿπŸÑŸâ ÿ£ŸÜ ÿßŸÑÿ¨ŸáÿØ (V) ÿπÿ®ÿ± ŸÖŸàÿµŸÑ Ÿäÿ™ŸÜÿßÿ≥ÿ® ÿ∑ÿ±ÿØŸäÿßŸã ŸÖÿπ ÿßŸÑÿ™Ÿäÿßÿ± (I) ÿßŸÑŸÖÿßÿ± ŸÅŸäŸá: /* [94] */
\\[ V = I \\times R \\] /* [94] */
ÿ≠Ÿäÿ´ R ŸáŸä ÿßŸÑŸÖŸÇÿßŸàŸÖÿ© Ÿàÿ™ŸÇÿßÿ≥ ÿ®ÿßŸÑÿ£ŸàŸÖ (Œ©). /* [94] */
4. ÿ™ÿ∑ÿ®ŸäŸÇÿßÿ™ ÿπŸÖŸÑŸäÿ© /* [95] */
ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÑÿØŸäŸÜÿß ÿ≥ŸÑŸÉ ÿ∑ŸàŸÑŸá L1 ŸàŸÖÿ≥ÿßÿ≠ÿ© ŸÖŸÇÿ∑ÿπŸá A1 ŸàŸÖŸÇÿßŸàŸÖÿ™Ÿá R1ÿå ŸàÿπŸÜÿØŸÖÿß Ÿäÿµÿ®ÿ≠ ÿ∑ŸàŸÑ ÿßŸÑÿ≥ŸÑŸÉ \\( L2 = 2L1 \\)), ÿ™ÿµÿ®ÿ≠ ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ© \\( A2 = \\frac{A1}{2} \\). /* [95] */
ÿßŸÑŸÖŸÇÿßŸàŸÖÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ©: /* [96] */
\\[ /* [96] */
R2 = \\rho \\frac{2L1}{\\frac{A1}{2}} = 4R1 /* [96] */
\\]`; /* [96] */

        // ŸÖÿ´ÿßŸÑ ŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸàŸÇÿ™ ŸÑŸÑŸÜÿµ (Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ÿ™ÿ∑ÿßÿ®ŸÇ ŸÖÿπ ÿßŸÑŸÅŸäÿØŸäŸà ÿßŸÑÿ≠ŸÇŸäŸÇŸä)
        captionsData = [
          { time: 5, text: "ŸÖŸÇÿØŸÖÿ© ÿπŸÜ ÿßŸÑŸÅŸäÿ≤Ÿäÿßÿ°" }, /* [96] */
          { time: 15, text: "ÿßŸÑÿ™Ÿäÿßÿ± ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ¶Ÿä" }, /* [96] */
          { time: 25, text: "ŸÇÿßŸÜŸàŸÜ ÿ£ŸàŸÖ" }, /* [96] */
          { time: 35, text: "ÿ™ÿ∑ÿ®ŸäŸÇÿßÿ™ ÿπŸÖŸÑŸäÿ©" } /* [96] */
        ];
        document.getElementById("transcriptInput").value = mockTranscript; /* [97] */
      } catch (error) { /* [97] */
        document.getElementById("transcriptInput").value = "‚ö†Ô∏è ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ¨ŸÑÿ® ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ©ÿå ÿ£ÿØÿÆŸÑ ÿßŸÑŸÜÿµ ŸäÿØŸàŸäŸãÿß."; /* [97] */
        console.error("ÿÆÿ∑ÿ£ ÿ¨ŸÑÿ® ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ©:", error);
      } /* [98] */
    }

    function searchInText() {
      const query = document.getElementById("searchText").value.trim(); /* [98] */
      if (!query) return alert("‚ùå Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ŸÜÿµ ŸÑŸÑÿ®ÿ≠ÿ´"); /* [99] */

      const transcriptArea = document.getElementById("transcriptInput");
      let transcript = transcriptArea.value; /* [99] */
      if (!transcript) return alert("‚ùå ŸÑÿß ŸäŸàÿ¨ÿØ ŸÜÿµ ŸÑŸÑÿ®ÿ≠ÿ´ ŸÅŸäŸá"); /* [100] */

      // ÿ£ÿ≤ŸÑ ÿßŸÑÿ™ÿ∏ŸÑŸäŸÑ ÿßŸÑÿ≥ÿßÿ®ŸÇ ŸÇÿ®ŸÑ ÿßŸÑÿ®ÿ≠ÿ´ ÿßŸÑÿ¨ÿØŸäÿØ
      removeHighlights();
      transcript = document.getElementById("transcriptInput").value; // ÿ£ÿπÿØ ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑŸÜÿµ ÿßŸÑÿ£ÿµŸÑŸä

      const lines = transcript.split('\n'); /* [100] */
      let resultsHTML = ''; /* [100] */
      let foundCount = 0; /* [101] */
      let firstMatchLineIndex = -1;

      lines.forEach((line, index) => { /* [101] */
        if (line.toLowerCase().includes(query.toLowerCase())) { /* [101] */
          foundCount++; /* [101] */
          if (firstMatchLineIndex === -1) {
              firstMatchLineIndex = index;
          }
          // ŸÑÿß ŸÜÿ≥ÿ™ÿÆÿØŸÖ highlightText ŸáŸÜÿß ŸÖÿ®ÿßÿ¥ÿ±ÿ©ÿå ÿ≥ŸÜŸÇŸàŸÖ ÿ®ÿ™ÿ∏ŸÑŸäŸÑ ÿßŸÑŸÉŸÑ ŸÖÿ±ÿ© Ÿàÿßÿ≠ÿØÿ©
          // ŸàŸÜÿπÿ±ÿ∂ ŸÅŸÇÿ∑ ÿßŸÑŸÜÿµ ÿßŸÑÿ£ÿµŸÑŸä ŸÅŸä ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ŸÑÿ™ÿ¨ŸÜÿ® ÿ™ÿØÿßÿÆŸÑ ÿßŸÑŸÄ HTML
          resultsHTML += `<div class="highlight-line" onclick="jumpToLineAndHighlight(${index})">
            <b>ÿßŸÑÿ≥ÿ∑ÿ± ${index + 1}:</b> ${escapeHtml(line)}
          </div>`; /* [101] */
        }
      }); /* [101] */

      if (foundCount > 0) { /* [102] */
        document.getElementById("searchResults").innerHTML = `
          <p>ÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ${foundCount} ŸÜÿ™ÿßÿ¶ÿ¨:</p>
          ${resultsHTML}
        `; /* [102] */
        // ŸÇŸÖ ÿ®ÿ™ÿ∏ŸÑŸäŸÑ ŸÉŸÑ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ŸÅŸä ŸÖÿ±ÿ®ÿπ ÿßŸÑŸÜÿµ
        highlightAllOccurrences(transcript, query); /* [103] */
        document.getElementById("clearSearchBtn").style.display = 'inline-block'; /* [103] */
        if (firstMatchLineIndex >= 0) { /* [105] */
            // ŸÑÿß ÿ™ŸÇŸÖ ÿ®ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ŸáŸÜÿßÿå ÿßÿ™ÿ±ŸÉŸá ŸÑŸÄ jumpToLineAndHighlight
        } /* [106] */
      } else { /* [106] */
        document.getElementById("searchResults").innerHTML = "‚ö†Ô∏è ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ŸÜÿ™ÿßÿ¶ÿ¨"; /* [106] */
        document.getElementById("clearSearchBtn").style.display = 'none'; /* [107] */
      }
    }

    // ÿØÿßŸÑÿ© ŸÑŸÑŸáÿ±Ÿàÿ® ŸÖŸÜ HTML ŸÑÿ™ÿ¨ŸÜÿ® ŸÖÿ¥ÿßŸÉŸÑ ÿßŸÑÿπÿ±ÿ∂ ŸÅŸä ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨
    function escapeHtml(unsafe) {
        return unsafe
             .replace(/&/g, "&amp;")
             .replace(/</g, "&lt;")
             .replace(/>/g, "&gt;")
             .replace(/"/g, "&quot;")
             .replace(/'/g, "&#039;");
     }

    // ÿØÿßŸÑÿ© ÿ¨ÿØŸäÿØÿ© ŸÑŸÑŸÇŸÅÿ≤ ŸÑŸÑÿ≥ÿ∑ÿ± Ÿàÿ™ÿ∏ŸÑŸäŸÑŸá ÿπŸÜÿØ ÿßŸÑŸÜŸÇÿ± ÿπŸÑŸâ ŸÜÿ™Ÿäÿ¨ÿ© ÿßŸÑÿ®ÿ≠ÿ´
    function jumpToLineAndHighlight(lineNumber) {
        scrollToLine(lineNumber); // ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿ•ŸÑŸâ ÿßŸÑÿ≥ÿ∑ÿ±
        // ÿ£ÿ∂ŸÅ ŸáŸÜÿß ŸÖŸÜÿ∑ŸÇ ÿßŸÑŸÇŸÅÿ≤ ŸÅŸä ÿßŸÑŸÅŸäÿØŸäŸà ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÑÿØŸäŸÉ ÿ®ŸäÿßŸÜÿßÿ™ ÿ™ŸàÿßŸÅŸÇ ÿßŸÑÿ£ÿ≥ÿ∑ÿ± ŸÖÿπ ÿßŸÑŸàŸÇÿ™
        // const time = findTimeForLine(lineNumber);
        // if (time !== null) {
        //    jumpTo(time);
        // }
    }

    function clearSearch() {
      removeHighlights(); /* [107] */
      document.getElementById("clearSearchBtn").style.display = 'none'; /* [108] */
      document.getElementById("searchResults").innerHTML = ''; /* [108] */
      document.getElementById("searchText").value = ''; /* [108] */
    }

    // ŸÑÿß ÿ™ÿπÿØŸÑ ÿßŸÑŸÜÿµ ŸÖÿ®ÿßÿ¥ÿ±ÿ©ÿå ÿ®ŸÑ ÿÆÿ≤ŸÜ ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿ∏ŸÑŸÑ ŸÖŸÜŸÅÿµŸÑÿßŸã
    function highlightAllOccurrences(text, query) {
      const regex = new RegExp(`(${escapeRegExp(query)})`, 'gi'); /* [108] */
      const highlightedText = text.replace(regex, '<span class="highlight">$1</span>'); /* [109] */

      // ÿπÿ±ÿ∂ ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿ∏ŸÑŸÑ (ŸäŸÖŸÉŸÜ ÿπÿ±ÿ∂Ÿá ŸÅŸä ŸÖŸÉÿßŸÜ ÿ¢ÿÆÿ± ÿ£Ÿà ÿßÿ≥ÿ™ÿÆÿØÿßŸÖŸá ÿ®ÿ∑ÿ±ŸäŸÇÿ© ÿ£ÿÆÿ±Ÿâ)
      // ŸÑÿ™ÿ¨ŸÜÿ® ŸÖÿ¥ÿßŸÉŸÑ ÿßŸÑÿ™ÿ≠ÿ±Ÿäÿ±ÿå ŸÑÿß ŸÜÿ∂ÿπŸá ŸÖÿ®ÿßÿ¥ÿ±ÿ© ŸÅŸä textarea
      // currentHighlights.highlightedText = highlightedText;
      // document.getElementById("transcriptInput").value = highlightedText; // ÿ™ÿ¨ŸÜÿ® Ÿáÿ∞ÿß

      // ÿ®ÿØŸÑÿßŸã ŸÖŸÜ ÿ∞ŸÑŸÉÿå ŸäŸÖŸÉŸÜŸÜÿß ŸÅŸÇÿ∑ ÿ™ÿ™ÿ®ÿπ ÿ£ŸÖÿßŸÉŸÜ ÿßŸÑÿ™ÿ∏ŸÑŸäŸÑ
      currentHighlights.query = query;
      currentHighlights.originalText = text;

      // ŸäŸÖŸÉŸÜŸÉ ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ™ÿ∏ŸÑŸäŸÑ ŸÅŸä ÿπŸÜÿµÿ± ÿπÿ±ÿ∂ ŸÖŸÜŸÅÿµŸÑ ÿ•ÿ∞ÿß ÿ£ÿ±ÿØÿ™
      // document.getElementById("highlightedDisplay").innerHTML = highlightedText;

      // ÿ£Ÿà ŸäŸÖŸÉŸÜŸÉ ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ™ÿ∏ŸÑŸäŸÑ ŸÖÿ§ŸÇÿ™Ÿãÿß ÿπŸÑŸâ textarea ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ™ŸÇŸÜŸäÿßÿ™ CSS ÿ£ŸÉÿ´ÿ± ÿ™ÿπŸÇŸäÿØŸãÿß (ÿÆÿßÿ±ÿ¨ ÿßŸÑŸÜÿ∑ÿßŸÇ ÿßŸÑÿ≠ÿßŸÑŸä)
    } /* [113] */

    function escapeRegExp(string) {
      return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); /* [113] */
    } /* [114] */

    function removeHighlights() {
      // ÿ•ÿ∞ÿß ŸÉŸÜÿß ŸÜÿÆÿ≤ŸÜ ÿßŸÑŸÜÿµ ÿßŸÑÿ£ÿµŸÑŸäÿå ŸäŸÖŸÉŸÜŸÜÿß ÿßÿ≥ÿ™ÿπÿßÿØÿ™Ÿá
      if (currentHighlights.originalText) {
         document.getElementById("transcriptInput").value = currentHighlights.originalText; /* [115] */
      }
      // ŸÖÿ≥ÿ≠ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ™ÿ∏ŸÑŸäŸÑ
      currentHighlights = {}; /* [115] */
      // ÿ•ÿ∞ÿß ŸÉŸÜÿ™ ÿ™ÿ≥ÿ™ÿÆÿØŸÖ ÿπŸÜÿµÿ± ÿπÿ±ÿ∂ ŸÖŸÜŸÅÿµŸÑÿå ŸÇŸÖ ÿ®ŸÖÿ≥ÿ≠Ÿá
      // document.getElementById("highlightedDisplay").innerHTML = '';
    } /* [116] */

    function scrollToLine(lineNumber) {
      const textarea = document.getElementById("transcriptInput"); /* [116] */
      const lines = textarea.value.split('\n'); /* [116] */
      if (lineNumber >= lines.length) return; // ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿ±ŸÇŸÖ ÿßŸÑÿ≥ÿ∑ÿ±

      let position = 0; /* [117] */
      for (let i = 0; i < lineNumber; i++) { /* [117] */
        position += lines[i].length + 1; // +1 ŸÑÿ≠ÿ±ŸÅ ÿßŸÑÿ≥ÿ∑ÿ± ÿßŸÑÿ¨ÿØŸäÿØ /* [117] */
      } /* [118] */

      textarea.focus(); /* [118] */
      textarea.scrollTop = 0; // ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ÿπŸäŸäŸÜ ÿ£ŸàŸÑÿßŸã ŸÇÿØ Ÿäÿ≥ÿßÿπÿØ

      // ÿ≠ÿ≥ÿßÿ® ÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑÿ≥ÿ∑ÿ± ÿßŸÑÿ™ŸÇÿ±Ÿäÿ®Ÿä ŸÑŸÑÿ™ŸÖÿ±Ÿäÿ±
      const avgLineHeight = textarea.scrollHeight / lines.length;
      const scrollToPosition = lineNumber * avgLineHeight - (textarea.clientHeight / 3); // ÿ≠ÿßŸàŸÑ ÿßŸÑÿ™Ÿàÿ≥Ÿäÿ∑
      textarea.scrollTop = Math.max(0, scrollToPosition);

      // ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÜÿµ Ÿàÿ™ÿ∏ŸÑŸäŸÑŸá ŸÖÿ§ŸÇÿ™Ÿãÿß
      const endPosition = position + lines[lineNumber].length;
      textarea.setSelectionRange(position, endPosition); /* [118] */

      // ÿ™ÿ∏ŸÑŸäŸÑ ÿßŸÑÿÆŸÑŸÅŸäÿ© ÿßŸÑŸÖÿ§ŸÇÿ™ (ŸÇÿØ ŸÑÿß ŸäÿπŸÖŸÑ ÿ®ÿ¥ŸÉŸÑ ŸÖÿ´ÿßŸÑŸä ŸÅŸä ŸÉŸÑ ÿßŸÑŸÖÿ™ÿµŸÅÿ≠ÿßÿ™ ŸÖÿπ scrollTop)
      textarea.style.transition = 'background-color 0.2s ease-in-out';
      textarea.style.backgroundColor = 'rgba(255, 255, 0, 0.3)'; /* [118] */
      setTimeout(() => { /* [119] */
        textarea.style.backgroundColor = ''; /* [119] */
      }, 1500); /* [119] */
    } /* [120] */

    async function summarizeText() {
      const text = document.getElementById("transcriptInput").value; /* [120] */
      if (!text || text.trim() === "" || text.includes("‚è≥")) return alert("‚ùå Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ŸÜÿµ ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ© ÿ£Ÿà ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ± ÿ≠ÿ™Ÿâ Ÿäÿ™ŸÖ ÿ¨ŸÑÿ®Ÿá."); /* [121] */

      document.getElementById("summaryBox").innerHTML = "‚è≥ ÿ¨ÿßÿ±Ÿä ÿ™ŸÑÿÆŸäÿµ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ..."; /* [121] */
      try { /* [122] */
        const response = await fetch("https://openrouter.ai/api/v1/chat/completions", { /* [122] */
          method: "POST", /* [122] */
          headers: { /* [122] */
            "Authorization": `Bearer ${OPENROUTER_API_KEY}`, /* [122] */
            "Content-Type": "application/json", /* [122] */
            // ŸÇÿØ ÿ™ÿ≠ÿ™ÿßÿ¨ ŸÑÿ•ÿ∂ÿßŸÅÿ© Ÿáÿ∞ŸäŸÜ ÿßŸÑÿ≥ÿ∑ÿ±ŸäŸÜ ÿ≠ÿ≥ÿ® ŸÖÿ™ÿ∑ŸÑÿ®ÿßÿ™ OpenRouter
            // "HTTP-Referer": window.location.href, // ÿ£Ÿà ÿπŸÜŸàÿßŸÜ ŸÖŸàŸÇÿπŸÉ ÿßŸÑÿ´ÿßÿ®ÿ™
            // "X-Title": document.title // ÿ£Ÿà ÿßÿ≥ŸÖ ŸÖŸàŸÇÿπŸÉ
          },
          body: JSON.stringify({ /* [123] */
            "model": "anthropic/claude-3-haiku-20240307", // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÜŸÖŸàÿ∞ÿ¨ ÿ£ÿ≥ÿ±ÿπ Ÿàÿ£ÿ±ÿÆÿµ ŸÖÿ´ŸÑ Haiku
            "messages": [{ /* [123] */
              "role": "user", /* [123] */
              "content": `ŸÇŸÖ ÿ®ÿ™ŸÑÿÆŸäÿµ Ÿáÿ∞ÿß ÿßŸÑŸÜÿµ ÿßŸÑÿ™ÿπŸÑŸäŸÖŸä ÿ®ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ŸÖÿπ ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤ ÿπŸÑŸâ ÿßŸÑŸÜŸÇÿßÿ∑ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© ŸàÿßŸÑŸÖŸÅÿßŸáŸäŸÖ ÿßŸÑŸáÿßŸÖÿ©.
              ÿ•ÿ∞ÿß Ÿàÿ¨ÿØÿ™ ÿ£Ÿä ŸÇŸàÿßŸÜŸäŸÜ ÿ£Ÿà ŸÖÿπÿßÿØŸÑÿßÿ™ ÿ±Ÿäÿßÿ∂Ÿäÿ©ÿå ÿ£ÿ®ÿ±ÿ≤Ÿáÿß ÿ®Ÿàÿ∂Ÿàÿ≠ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿµŸäÿ∫ÿ© LaTeX. ŸÑŸÑŸÖÿπÿßÿØŸÑÿßÿ™ ÿØÿßÿÆŸÑ ÿßŸÑÿ≥ÿ∑ÿ± ÿßÿ≥ÿ™ÿÆÿØŸÖ \\( ... \\) ŸàŸÑŸÑŸÖÿπÿßÿØŸÑÿßÿ™ ŸÅŸä ÿ≥ÿ∑ÿ± ŸÖŸÜŸÅÿµŸÑ ÿßÿ≥ÿ™ÿÆÿØŸÖ \\[ ... \\].
              ŸÜÿ∏ŸÖ ÿßŸÑŸÖŸÑÿÆÿµ ŸÅŸä ŸÅŸÇÿ±ÿßÿ™ Ÿàÿßÿ∂ÿ≠ÿ©ÿå ŸàŸäŸÖŸÉŸÜŸÉ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿπŸÜÿßŸàŸäŸÜ ŸàÿßŸÑŸÜŸÇÿßÿ∑ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿ∞ŸÑŸÉ ŸÖŸÜÿßÿ≥ÿ®Ÿãÿß ŸÑÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸÇÿ±ÿßÿ°ÿ©.
              ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜ ÿßŸÑÿµŸäÿßÿ∫ÿ© ÿπÿ±ÿ®Ÿäÿ© Ÿàÿ≥ŸÑŸäŸÖÿ©.

              ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿ±ÿßÿØ ÿ™ŸÑÿÆŸäÿµŸá:\n\n${text}` /* [124] */
            }]
          }) /* [124] */
        }); /* [124] */

        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(`ÿÆÿ∑ÿ£ ŸÖŸÜ API: ${response.status} ${response.statusText} - ${errorData.error?.message || 'ŸÑÿß ŸäŸàÿ¨ÿØ ÿ™ŸÅÿßÿµŸäŸÑ'}`);
        }

        const data = await response.json(); /* [125] */
        let summary = "";
        if (data.choices && data.choices[0] && data.choices[0].message && data.choices[0].message.content) {
             summary = data.choices[0].message.content;
        } else {
            summary = "‚ö†Ô∏è ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ŸÖŸÑÿÆÿµ ÿ£Ÿà ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ≥ÿ™ÿ¨ÿßÿ®ÿ©.";
            console.error("ÿßÿ≥ÿ™ÿ¨ÿßÿ®ÿ© ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÇÿπÿ© ŸÖŸÜ API:", data);
        }

        // --- ÿ•ÿπÿßÿØÿ© ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ™ŸÜÿ≥ŸäŸÇÿßÿ™ ÿ®ÿπÿØ ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿßŸÑŸÖŸÑÿÆÿµ ---
        summary = formatMathEquations(summary); // ÿ™ŸÜÿ≥ŸäŸÇ LaTeX ÿ£ŸàŸÑÿßŸã /* [125] */
        // ÿ™ÿ≠ŸàŸäŸÑ Markdown ÿßŸÑÿ®ÿ≥Ÿäÿ∑ ÿ•ŸÑŸâ HTML
        summary = summary
          .replace(/\*\*(.*?)\*\*/g, '<b>$1</b>') // Bold /* [126] */
          .replace(/\*(.*?)\*/g, '<i>$1</i>')   // Italic /* [126] */
          .replace(/_(.*?)_/g, '<u>$1</u>')   // Underline (ŸÇÿØ Ÿäÿ™ÿπÿßÿ±ÿ∂ ŸÖÿπ Markdown ÿ£ÿÆÿ±Ÿâ) /* [126] */
          .replace(/```(.*?)```/gs, '<pre><code>$1</code></pre>') // Code blocks
          .replace(/`(.*?)`/g, '<code>$1</code>');        // Inline code

        // ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿ£ŸÇÿ≥ÿßŸÖ ŸàÿßŸÑÿπŸÜÿßŸàŸäŸÜ (ÿ®ÿßŸÅÿ™ÿ±ÿßÿ∂ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ Markdown #)
        summary = summary.replace(/^### (.*$)/gim, '<h4 class="summary-subtitle">$1</h4>');
        summary = summary.replace(/^## (.*$)/gim, '<h3 class="summary-section-title">$1</h3>');
        summary = summary.replace(/^# (.*$)/gim, '<h2 class="summary-main-title">$1</h2>');

        // ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÜŸÇÿ∑Ÿäÿ© ŸàÿßŸÑÿ±ŸÇŸÖŸäÿ©
        summary = summary.replace(/^\s*[-*+] (.*$)/gim, '<li>$1</li>');
        summary = summary.replace(/^\s*\d+\. (.*$)/gim, '<li>$1</li>'); // ÿ™ÿ≠ŸàŸäŸÑŸáÿß ŸÑŸÄ li ÿ£Ÿäÿ∂Ÿãÿß ŸÑŸÑÿ™ÿ®ÿ≥Ÿäÿ∑
        summary = summary.replace(/<ul>\s*<li>/g, '<ul><li>'); // ÿ•ÿµŸÑÿßÿ≠ ÿßŸÑŸÖÿ≥ÿßŸÅÿßÿ™
        summary = summary.replace(/<\/li>\s*<\/ul>/g, '</li></ul>');
        summary = summary.replace(/(<li>.*<\/li>)(?![\s\S]*<ul><li>)/g, '<ul>$1</ul>'); // ÿ•ÿ∂ÿßŸÅÿ© ul ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™ŸÉŸÜ ŸÖŸàÿ¨ŸàÿØÿ©
        summary = summary.replace(/<ol>\s*<li>/g, '<ol><li>'); // ÿ•ÿµŸÑÿßÿ≠ ÿßŸÑŸÖÿ≥ÿßŸÅÿßÿ™
        summary = summary.replace(/<\/li>\s*<\/ol>/g, '</li></ol>');
        summary = summary.replace(/(<li>.*<\/li>)(?![\s\S]*<ol><li>)/g, '<ol>$1</ol>'); // ÿ•ÿ∂ÿßŸÅÿ© ol ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™ŸÉŸÜ ŸÖŸàÿ¨ŸàÿØÿ©

        summary = summary.replace(/\n/g, '<br>'); // ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿ£ÿ≥ÿ∑ÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ© /* [126] */
        // ÿ•ÿ≤ÿßŸÑÿ© <br> ÿßŸÑÿ≤ÿßÿ¶ÿØÿ© ÿ®ÿπÿØ ÿßŸÑÿπŸÜÿßŸàŸäŸÜ ÿ£Ÿà ÿØÿßÿÆŸÑ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ
        summary = summary.replace(/<\/(h[2-4]|ul|ol|li|pre)><br>/gi, '</$1>');
        summary = summary.replace(/<(ul|ol)><br>/gi, '<$1>');
        summary = summary.replace(/<br><br>/g, '<br>'); // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ£ÿ≥ÿ∑ÿ± ÿßŸÑŸÖÿ≤ÿØŸàÿ¨ÿ©

        // summary = enhanceSummaryStructure(summary); // ŸÇÿØ ÿ™ŸÉŸàŸÜ Ÿáÿ∞Ÿá ÿßŸÑÿØÿßŸÑÿ© ŸÖÿπŸÇÿØÿ© Ÿàÿ™ÿ™ÿπÿßÿ±ÿ∂ ŸÖÿπ Markdown

        document.getElementById("summaryBox").innerHTML = summary; /* [127] */
        if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) { /* [127] */
          MathJax.typesetPromise([document.getElementById("summaryBox")]).then(() => { /* [127] */
            console.log('MathJax rendering complete for summary'); /* [127] */
          }).catch((err) => { /* [127] */
            console.error('MathJax rendering error:', err); /* [127] */
          });
        } /* [128] */
      } catch (error) { /* [128] */
        document.getElementById("summaryBox").innerHTML = `‚ùå ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ¨ŸÑÿ® ÿßŸÑŸÖŸÑÿÆÿµ: ${error.message}`; /* [128] */
        console.error("ÿÆÿ∑ÿ£ ÿ™ŸÑÿÆŸäÿµ ÿßŸÑŸÜÿµ:", error); /* [129] */
      }
    }

    function formatMathEquations(text) {
        // ÿ£ŸàŸÑÿßŸãÿå ÿßŸÑŸÖÿπÿßÿØŸÑÿßÿ™ ÿßŸÑŸÖŸÜŸÅÿµŸÑÿ© (Block)
        text = text.replace(/\\\[([\s\S]*?)\\\]/gs, function(match, equation) { /* [129] */
            // ÿ•ÿ≤ÿßŸÑÿ© ÿ£Ÿä ÿ™ÿßÿ¨ÿßÿ™ HTML ŸÇÿØ ÿ™ŸÉŸàŸÜ ÿ™ÿ≥ŸÑŸÑÿ™ ÿØÿßÿÆŸÑ ÿßŸÑŸÖÿπÿßÿØŸÑÿ©
            equation = equation.replace(/<[^>]*>/g, '').trim(); /* [129] */
            // ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿπÿØŸÖ Ÿàÿ¨ŸàÿØ <br> ÿØÿßÿÆŸÑ ÿßŸÑŸÖÿπÿßÿØŸÑÿ©
            equation = equation.replace(/<br\s*\/?>/gi, ' ');
            // ÿ•ÿ∂ÿßŸÅÿ© ÿ≠ÿßŸàŸäÿ© ÿÆÿßÿµÿ© ŸÑŸÑŸÖÿπÿßÿØŸÑÿßÿ™ ÿßŸÑŸÖŸÜŸÅÿµŸÑÿ©
            return `<div class="math-container">\\[${equation}\\]</div>`; /* [129] */
        });
        // ÿ´ÿßŸÜŸäÿßŸãÿå ÿßŸÑŸÖÿπÿßÿØŸÑÿßÿ™ ÿßŸÑÿ≥ÿ∑ÿ±Ÿäÿ© (Inline)
        text = text.replace(/\\\((.*?)\\\)/gs, function(match, equation) { /* [130] */
            equation = equation.replace(/<[^>]*>/g, '').trim(); /* [130] */
            equation = equation.replace(/<br\s*\/?>/gi, ' ');
            // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ span ŸÖÿπ ŸÉŸÑÿßÿ≥ ÿÆÿßÿµ ŸÑŸÑŸÖÿπÿßÿØŸÑÿßÿ™ ÿßŸÑÿ≥ÿ∑ÿ±Ÿäÿ©
            return `<span class="latex">\\(${equation}\\)</span>`; /* [130] */
        });
        return text; /* [131] */
    }


    // ŸäŸÖŸÉŸÜ ÿ™ÿ®ÿ≥Ÿäÿ∑ Ÿáÿ∞Ÿá ÿßŸÑÿØÿßŸÑÿ© ÿ£Ÿà ÿ•ÿ≤ÿßŸÑÿ™Ÿáÿß ÿ•ÿ∞ÿß ÿßÿπÿ™ŸÖÿØŸÜÿß ÿπŸÑŸâ ÿ™ŸÜÿ≥ŸäŸÇ Markdown ŸÖŸÜ API
    /*
    function enhanceSummaryStructure(summary) {
      let enhanced = summary;
      // Ÿáÿ∞Ÿá ÿßŸÑÿ™ÿπÿßÿ®Ÿäÿ± ÿßŸÑŸÜŸÖÿ∑Ÿäÿ© ŸÇÿØ ÿ™ŸÉŸàŸÜ Ÿáÿ¥ÿ© Ÿàÿ™ÿπÿ™ŸÖÿØ ÿπŸÑŸâ ÿ™ŸÜÿ≥ŸäŸÇ ŸÖÿπŸäŸÜ ÿ¨ÿØÿßŸã
      enhanced = enhanced.replace(/<br><br>(\d+\..*?)<br>/g, '<div class="summary-section"><div class="summary-title">$1</div>');
      enhanced = enhanced.replace(/<br><br>(?=<div class="summary-section">)/g, '</div>'); // ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÇÿ≥ŸÖ ÿßŸÑÿ≥ÿßÿ®ŸÇ
      enhanced += '</div>'; // ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÇÿ≥ŸÖ ÿßŸÑÿ£ÿÆŸäÿ±
      enhanced = enhanced.replace(/(ÿßŸÑŸÇÿßŸÜŸàŸÜ|ŸÇÿßŸÜŸàŸÜ|ÿßŸÑŸÖÿπÿßÿØŸÑÿ©|ŸÖÿπÿßÿØŸÑÿ©)(.*?):<br>/g, '<div class="summary-laws"><div class="law-title">$1$2:</div>');
      enhanced = enhanced.replace(/<br><br>(?!\s*<div class="summary-laws">)/g, '</div><br>'); // ÿ•ÿ∫ŸÑÿßŸÇ ŸÇÿ≥ŸÖ ÿßŸÑŸÇŸàÿßŸÜŸäŸÜ
      return enhanced;
    }
    */

    function saveNote() {
      if (!isPlayerReady()) {
        // ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ŸÑÿ™ŸÉŸàŸÜ ÿ£Ÿàÿ∂ÿ≠ ŸÇŸÑŸäŸÑÿßŸã
        alert("‚ùå ŸÑÿß ŸäŸÖŸÉŸÜ ÿ≠ŸÅÿ∏ ŸÖŸÑÿßÿ≠ÿ∏ÿ© ÿßŸÑÿ¢ŸÜ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ± ÿ≠ÿ™Ÿâ Ÿäÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÅŸäÿØŸäŸà Ÿàÿ¨ÿßŸáÿ≤Ÿäÿ™Ÿá."); /* [133] */
        return; /* [134] */
      }
      try {
        let currentTime = player.getCurrentTime(); /* [134] */
        let noteText = document.getElementById("noteText").value; /* [135] */

        if (noteText.trim() !== "") { /* [135] */
          notes.push({ time: currentTime, text: noteText }); /* [135] */
          updateNotesList(); /* [136] */
          document.getElementById("noteText").value = ""; /* [136] */
          console.log("ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑŸÖŸÑÿßÿ≠ÿ∏ÿ© ŸÅŸä ÿßŸÑŸàŸÇÿ™:", currentTime); /* [136] */
        } else { /* [137] */
          alert("‚ùå Ÿäÿ±ÿ¨Ÿâ ŸÉÿ™ÿßÿ®ÿ© ŸÖŸÑÿßÿ≠ÿ∏ÿ© ŸÇÿ®ŸÑ ÿßŸÑÿ≠ŸÅÿ∏."); /* [137] */
        } /* [138] */
      } catch (e) { /* [138] */
        console.error("ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑŸÖŸÑÿßÿ≠ÿ∏ÿ©:", e); /* [138] */
        alert("‚ùå ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑŸÖŸÑÿßÿ≠ÿ∏ÿ©"); /* [139] */
      }
    }

    function updateNotesList() {
      let notesList = document.getElementById("notesList"); /* [139] */
      notesList.innerHTML = ""; /* [140] */

      // ŸÅÿ±ÿ≤ ÿßŸÑŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ ÿ≠ÿ≥ÿ® ÿßŸÑŸàŸÇÿ™
      notes.sort((a, b) => a.time - b.time);

      notes.forEach((note, index) => { /* [140] */
        let listItem = document.createElement("li"); /* [140] */
        listItem.innerHTML = `
            <span><b>[${formatTime(note.time)}]</b> ${escapeHtml(note.text)}</span>
            <div>
                <button class="control-btn" style="padding: 5px 10px; font-size: 14px;" onclick="jumpTo(${note.time})">üîó ÿßŸÜÿ™ŸÇŸÑ</button>
                <button class="clear-search-btn" style="padding: 5px 10px; font-size: 14px; background-color: #6c757d;" onclick="deleteNote(${index})">üóë ÿ≠ÿ∞ŸÅ</button>
            </div>
        `;
        // ÿ•ÿ∂ÿßŸÅÿ© ÿ®ÿπÿ∂ ÿßŸÑÿ™ŸÜÿ≥ŸäŸÇ ŸÑÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ±
        listItem.style.display = "flex";
        listItem.style.justifyContent = "space-between";
        listItem.style.alignItems = "center";
        notesList.appendChild(listItem); /* [140] */
      });
    } /* [141] */

     // ÿØÿßŸÑÿ© ŸÑÿ≠ÿ∞ŸÅ ŸÖŸÑÿßÿ≠ÿ∏ÿ©
    function deleteNote(index) {
        if (confirm(`ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞Ÿá ÿßŸÑŸÖŸÑÿßÿ≠ÿ∏ÿ©ÿü\n"${notes[index].text.substring(0, 50)}..."`)) {
            notes.splice(index, 1);
            updateNotesList();
            console.log("ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸÑÿßÿ≠ÿ∏ÿ© ÿ±ŸÇŸÖ:", index);
        }
    }

    function jumpTo(time) {
      if (!isPlayerReady()) {
        alert("‚ùå Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ± ÿ≠ÿ™Ÿâ Ÿäÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÅŸäÿØŸäŸà ÿ®ÿßŸÑŸÉÿßŸÖŸÑ Ÿàÿ¨ÿßŸáÿ≤Ÿäÿ™Ÿá"); /* [141] */
        return; /* [142] */
      }
      try {
        player.seekTo(time, true); /* [142] */
        // ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑŸÅŸäÿØŸäŸà ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÖÿ™ŸàŸÇŸÅŸãÿß ÿπŸÜÿØ ÿßŸÑŸÇŸÅÿ≤
        if (player.getPlayerState() !== YT.PlayerState.PLAYING) { /* [143] */
            player.playVideo(); /* [143] */
            // isPlaying ÿ≥Ÿäÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´Ÿáÿß ÿ®Ÿàÿßÿ≥ÿ∑ÿ© onPlayerStateChange
        } /* [144] */
        console.log("ÿ™ŸÖ ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ÿ•ŸÑŸâ ÿßŸÑŸàŸÇÿ™:", time); /* [144] */
      } catch (e) { /* [145] */
        console.error("ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ÿ•ŸÑŸâ ÿßŸÑŸÖŸÑÿßÿ≠ÿ∏ÿ©:", e); /* [145] */
        alert("‚ùå ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ÿ•ŸÑŸâ ÿßŸÑŸÖŸÑÿßÿ≠ÿ∏ÿ©"); /* [146] */
      }
    }

    function formatTime(seconds) {
      seconds = Math.max(0, seconds); // ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜ ÿßŸÑŸàŸÇÿ™ ŸÑŸäÿ≥ ÿ≥ÿßŸÑÿ®Ÿãÿß
      let min = Math.floor(seconds / 60); /* [146] */
      let sec = Math.floor(seconds % 60); /* [147] */
      return `${min}:${sec < 10 ? "0" : ""}${sec}`; /* [147] */
    } /* [148] */

    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode"); /* [148] */
      // ŸÑÿß ÿ™ÿ≠ÿ™ÿßÿ¨ ŸÑÿ•ÿπÿßÿØÿ© ÿßŸÑÿ®ÿ≠ÿ´ ŸáŸÜÿßÿå ŸÅŸÇÿ∑ ÿßŸÑŸàÿ∂ÿπ Ÿäÿ™ÿ∫Ÿäÿ±
      // const searchText = document.getElementById("searchText").value;
      // if (searchText && searchText.trim() !== "") {
      //   searchInText();
      // }

      // ÿ•ÿπÿßÿØÿ© ÿπÿ±ÿ∂ MathJax ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÑŸäŸÑŸä Ÿäÿ§ÿ´ÿ± ÿπŸÑŸâ ÿ£ŸÑŸàÿßŸÜŸá
      if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) { /* [150] */
        MathJax.typesetPromise().then(() => { /* [150] */
          console.log('MathJax rendering complete after dark mode toggle'); /* [150] */
        }).catch((err) => { /* [150] */
          console.error('MathJax rendering error:', err); /* [150] */
        });
      } /* [151] */
    }

    // ÿßÿ≥ÿ™ÿØÿπÿßÿ° ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸàÿßÿ¨Ÿáÿ© ÿßŸÑÿ®ÿ±ŸÖÿ¨Ÿäÿ© ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©
    loadYouTubeAPI(); /* [151] */

    // ÿ™ÿ≠ÿØŸäÿ´ ÿ≤ÿ± ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ/ÿßŸÑÿ•ŸäŸÇÿßŸÅ ŸÖÿ®ÿØÿ¶ŸäŸãÿß ŸÑŸäÿπŸÉÿ≥ ÿ≠ÿßŸÑÿ© ÿπÿØŸÖ ÿßŸÑÿ¨ÿßŸáÿ≤Ÿäÿ©
    document.addEventListener('DOMContentLoaded', () => {
        updatePlayPauseButton();
    });

  </script>
</body>
</html>